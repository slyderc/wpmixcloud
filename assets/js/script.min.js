!function(){"use strict";function e(){const e=document.querySelectorAll(".mixcloud-player-wrapper");if(0!==e.length)if("IntersectionObserver"in window){const n=new IntersectionObserver(function(e,n){e.forEach(function(e){if(e.isIntersecting){const o=e.target;t(o),n.unobserve(o)}})},{rootMargin:"50px",threshold:.1});e.forEach(function(e){n.observe(e)})}else e.forEach(function(e){t(e)})}function t(e){const t=e.querySelector(".mixcloud-player-load-btn"),o=e.querySelector(".mixcloud-player-lazy");t&&o&&(t.addEventListener("click",function(){n(e,o,t)}),window.matchMedia("(prefers-reduced-motion: reduce)").matches&&n(e,o,t))}function n(e,t,n){const o=t.getAttribute("data-src");o&&(e.classList.add("mixcloud-player-loading"),n.disabled=!0,n.innerHTML='<span class="mixcloud-loading-spinner"></span>'+wpMixcloudArchives.loadingText,t.addEventListener("load",function(){e.classList.remove("mixcloud-player-loading"),e.classList.add("mixcloud-player-loaded"),n.style.display="none",t.style.display="block"},{once:!0}),t.addEventListener("error",function(){e.classList.remove("mixcloud-player-loading"),e.classList.add("mixcloud-player-error"),n.innerHTML='<span class="dashicons dashicons-warning"></span>'+wpMixcloudArchives.errorText,n.disabled=!1},{once:!0}),t.src=o)}function o(){const e=document.querySelectorAll(".mixcloud-stats");if("IntersectionObserver"in window){const t=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&e.target.classList.add("mixcloud-stats-visible")})},{threshold:.5});e.forEach(function(e){t.observe(e)})}}function i(){const e=document.querySelectorAll(".mixcloud-artwork[data-src]");if(0!==e.length)if("IntersectionObserver"in window){const t=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){const n=e.target;a(n),t.unobserve(n)}})},{rootMargin:"25px",threshold:.1});e.forEach(function(e){t.observe(e)})}else e.forEach(function(e){a(e)})}function a(e){const t=e.getAttribute("data-src");if(!t)return;e.classList.add("mixcloud-artwork-loading");const n=new Image;n.onload=function(){e.src=t,e.classList.remove("mixcloud-artwork-loading"),e.classList.add("mixcloud-artwork-loaded"),e.removeAttribute("data-src")},n.onerror=function(){e.classList.remove("mixcloud-artwork-loading"),c(e)},n.src=t}function r(){document.querySelectorAll(".mixcloud-artwork").forEach(function(e){e.addEventListener("error",function(){c(e)},{once:!0})})}function c(e){const t=e.parentElement;e.style.display="none";const n=document.createElement("div");n.className="mixcloud-artwork-error",n.innerHTML='<span class="dashicons dashicons-format-audio"></span>',n.setAttribute("aria-label",wpMixcloudArchives.noArtworkText),t.appendChild(n)}const s=new Map;async function l(e,t,n={}){const{timeout:o=1e4,retries:i=2,signal:a}=n;let r;for(let n=0;n<=i;n++)try{const n=new Promise((e,t)=>{setTimeout(()=>t(new Error("Request timeout")),o)}),i=fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t),signal:a}),r=await Promise.race([i,n]);if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);return await r.json()}catch(e){if(r=e,"AbortError"===e.name)throw e;if(n===i)throw e;const t=Math.min(1e3*Math.pow(2,n),5e3);await new Promise(e=>setTimeout(e,t))}throw r}function d(t,n,a){const c=document.querySelector('.mixcloud-archives-container[data-account="'+t+'"]'),d=c?c.querySelector(".mixcloud-archives-table tbody"):null,m=c?c.querySelector(".mixcloud-date-apply"):null;if(!c||!d||!m)return;const f=`filter_${t}_${n}_${a}`;if(s.has(f))return;m.disabled=!0,m.innerHTML='<span class="mixcloud-loading-spinner"></span>'+(wpMixcloudArchives.filteringText||"Filtering..."),d.classList.add("mixcloud-table-loading");const p={action:"mixcloud_filter_by_date",nonce:wpMixcloudArchives.nonce,account:t,start_date:n,end_date:a,limit:20,lazy_load:"true",mini_player:"true"},h=new AbortController;s.set(f,h),l(wpMixcloudArchives.ajaxUrl,p,{signal:h.signal,timeout:1e4,retries:2}).then(t=>{t.success?(d.innerHTML=t.data.html,e(),i(),r(),o(),u(c,t.data.message,"success")):u(c,t.data.message||"An error occurred while filtering.","error")}).catch(e=>{if("AbortError"!==e.name){console.error("Date filter error:",e);const t=e.message||wpMixcloudArchives.filterErrorText||"Failed to filter results. Please try again.";u(c,t,"error")}}).finally(()=>{s.delete(f),m.disabled=!1,m.innerHTML=wpMixcloudArchives.applyFilterText||"Apply Filter",d.classList.remove("mixcloud-table-loading")})}function u(e,t,n){e.querySelectorAll(".mixcloud-filter-message").forEach(e=>e.remove());const o=document.createElement("div");o.className="mixcloud-filter-message mixcloud-filter-message-"+n,o.innerHTML=t;const i=e.querySelector(".mixcloud-date-filter");i?i.parentNode.insertBefore(o,i.nextSibling):e.insertBefore(o,e.firstChild),setTimeout(()=>{o.parentNode&&o.remove()},5e3)}function m(){document.querySelectorAll(".mixcloud-pagination").forEach(function(t){const n=t.getAttribute("data-account");t.querySelectorAll(".mixcloud-pagination-btn, .mixcloud-pagination-link").forEach(function(t){t.addEventListener("click",function(t){t.preventDefault();const a=this.getAttribute("data-page");a&&!this.classList.contains("mixcloud-pagination-disabled")&&function(t,n){const a=document.querySelector('.mixcloud-archives-container[data-account="'+t+'"]'),c=a?a.querySelector(".mixcloud-archives-table tbody"):null,d=a?a.querySelector(".mixcloud-pagination"):null;if(!a||!c||!d)return;const f=`paginate_${t}_${n}`;if(s.has(f))return;const p=a.querySelector(".mixcloud-start-date"),h=a.querySelector(".mixcloud-end-date"),g=p?p.value:"",x=h?h.value:"";d.classList.add("mixcloud-pagination-loading"),c.classList.add("mixcloud-table-loading");d.querySelector(".mixcloud-pagination-info");let y=10;const w={action:"mixcloud_paginate",nonce:wpMixcloudArchives.nonce,account:t,page:n,per_page:y,start_date:g,end_date:x,limit:100,lazy_load:"true",mini_player:"true"},v=new AbortController;s.set(f,v),l(wpMixcloudArchives.ajaxUrl,w,{signal:v.signal,timeout:15e3,retries:2}).then(t=>{t.success?(c.innerHTML=t.data.table_html,d.outerHTML=t.data.pagination_html,e(),i(),r(),o(),m(),a.scrollIntoView({behavior:"smooth",block:"start"}),u(a,t.data.message,"success")):u(a,t.data.message||"An error occurred while loading the page.","error")}).catch(e=>{if("AbortError"!==e.name){console.error("Pagination error:",e);const t=e.message||wpMixcloudArchives.paginationErrorText||"Failed to load page. Please try again.";u(a,t,"error")}}).finally(()=>{s.delete(f);const e=document.querySelector('.mixcloud-pagination[data-account="'+t+'"]');e&&e.classList.remove("mixcloud-pagination-loading"),c.classList.remove("mixcloud-table-loading")})}(n,parseInt(a))})});t.querySelectorAll(".mixcloud-pagination-number").forEach(function(e){e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())})})})}function f(){document.querySelectorAll(".mixcloud-social-btn").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("data-platform"),n=this.closest(".mixcloud-social-sharing");if(!n)return;!function(e,t,n,o,i){let a="";switch(e){case"facebook":a="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t);break;case"twitter":a="https://twitter.com/intent/tweet?text="+encodeURIComponent(n+" - "+o)+"&url="+encodeURIComponent(t);break;case"bluesky":a="https://bsky.app/intent/compose?text="+encodeURIComponent(n+" - "+o+" "+t);break;case"copy":return void function(e,t){navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(function(){h(t)}).catch(function(n){console.warn("Failed to copy to clipboard:",n),p(e,t)}):p(e,t)}(t,i)}if(a){"undefined"!=typeof gtag&&gtag("event","share",{method:e,content_type:"mixcloud_track",content_id:t});const n=window.open(a,"social-share","width=600,height=400,scrollbars=yes,resizable=yes");n&&n.focus()}}(t,n.getAttribute("data-url"),n.getAttribute("data-title"),n.getAttribute("data-description"),this)})})}function p(e,t){const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy")?h(t):g(t)}catch(e){console.warn("Fallback copy failed:",e),g(t)}document.body.removeChild(n)}function h(e){const t=e.innerHTML,n=e.className;e.classList.add("copied"),e.innerHTML='<span class="dashicons dashicons-yes"></span><span class="mixcloud-social-label">Copied!</span>',"undefined"!=typeof gtag&&gtag("event","copy_link",{event_category:"social_sharing",event_label:"mixcloud_track"}),setTimeout(function(){e.className=n,e.innerHTML=t},2e3)}function g(e){const t=e.innerHTML;e.innerHTML='<span class="dashicons dashicons-no"></span><span class="mixcloud-social-label">Failed</span>',setTimeout(function(){e.innerHTML=t},2e3)}function x(){e(),i(),document.querySelectorAll(".mixcloud-archives-table").forEach(function(e){const t=e.querySelectorAll("thead th");e.querySelectorAll("tbody tr").forEach(function(e){e.querySelectorAll("td").forEach(function(e,n){t[n]&&e.setAttribute("data-label",t[n].textContent)})})}),o(),r(),document.querySelectorAll(".mixcloud-date-filter").forEach(function(e){const t=e.querySelector(".mixcloud-date-apply"),n=e.querySelector(".mixcloud-date-clear"),o=e.querySelector(".mixcloud-start-date"),i=e.querySelector(".mixcloud-end-date");if(!(t&&n&&o&&i))return;let a;function r(){clearTimeout(a),a=setTimeout(function(){const e=o.getAttribute("data-account"),t=o.value,n=i.value;t&&n&&new Date(t)<=new Date(n)&&d(e,t,n)},500)}t.addEventListener("click",function(){const e=this.getAttribute("data-account"),t=o.value,n=i.value;t&&n&&new Date(t)>new Date(n)?alert(wpMixcloudArchives.invalidDateRangeText||"End date must be after start date."):d(e,t,n)}),n.addEventListener("click",function(){const e=this.getAttribute("data-account");o.value="",i.value="",d(e,"","")}),o.addEventListener("change",r),i.addEventListener("change",r)}),m(),f()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",x):x(),document.addEventListener("wp-mixcloud-archives-refresh",x)}(),window.wpMixcloudArchivesRefresh=function(){document.dispatchEvent(new Event("wp-mixcloud-archives-refresh"))};