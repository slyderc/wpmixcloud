!function(){"use strict";function e(){const e=document.querySelectorAll(".mixcloud-play-button");let t=null;function o(e){e.style.opacity="0",setTimeout(()=>{e.style.display="none",e.innerHTML=""},300)}e.forEach(function(e){e.addEventListener("click",function(n){n.preventDefault();const i=e.closest(".mixcloud-list-item"),r=i.querySelector(".mixcloud-inline-player"),c=e.getAttribute("data-cloudcast-url"),a=e.getAttribute("data-cloudcast-name");e.getAttribute("data-cloudcast-key");r&&c&&function(e,n,i,r){const c="block"===n.style.display;t&&t!==n&&o(t);c?(o(n),t=null):(!function(e,t,o){const n={feed:encodeURIComponent(t),hide_cover:"1",mini:"1",light:"0",hide_artwork:"1"},i=Object.keys(n).map(e=>e+"="+n[e]).join("&"),r="https://www.mixcloud.com/widget/iframe/?"+i,c=document.createElement("iframe");c.src=r,c.width="100%",c.height="60",c.frameBorder="0",c.allowFullscreen=!0,c.title="Mixcloud player for "+o,e.innerHTML="",e.appendChild(c),e.style.display="block",e.style.opacity="0",setTimeout(()=>{e.style.transition="opacity 0.3s ease",e.style.opacity="1"},10)}(n,i,r),t=n,setTimeout(()=>{e.getBoundingClientRect().bottom>window.innerHeight&&e.scrollIntoView({behavior:"smooth",block:"center"})},100))}(i,r,c,a)})})}function t(){document.querySelectorAll(".mixcloud-custom-dropdown").forEach(e=>{const t=e.querySelector(".mixcloud-dropdown-selected"),o=e.querySelector(".mixcloud-dropdown-options"),n=e.querySelectorAll(".mixcloud-dropdown-option"),i=e.querySelector(".mixcloud-dropdown-text");function r(){t.setAttribute("aria-expanded","true"),o.classList.add("mixcloud-dropdown-open");const e=o.querySelector(".mixcloud-dropdown-option");e&&e.focus(),setTimeout(()=>{document.addEventListener("click",a)},0)}function c(){t.setAttribute("aria-expanded","false"),o.classList.remove("mixcloud-dropdown-open"),document.removeEventListener("click",a),t.focus()}function a(t){e.contains(t.target)||c()}function s(t){const o=t.getAttribute("data-value"),r=t.textContent;var a;i.textContent=r,n.forEach(e=>{e.classList.remove("mixcloud-dropdown-option-active"),e.setAttribute("aria-selected","false")}),t.classList.add("mixcloud-dropdown-option-active"),t.setAttribute("aria-selected","true"),e.setAttribute("data-current-filter",o),a=o,document.querySelectorAll(".mixcloud-list-item").forEach(e=>{const t=e.querySelector(".mixcloud-list-title").textContent.replace(/\s*[–-•]\s*\d{1,2}\/\d{1,2}\/\d{4}$/,"").replace(/\s*[–-•]\s*\d{4}-\d{2}-\d{2}$/,"").replace(/\s*[–-•]\s*\d{1,2}-\d{1,2}-\d{4}$/,"").trim();e.style.display="all"===a||t===a?"flex":"none"}),c()}t&&o&&i&&(t.addEventListener("click",function(){"true"===t.getAttribute("aria-expanded")?c():r()}),n.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),s(e)})}),t.addEventListener("keydown",e=>{switch(e.key){case"Enter":case" ":case"ArrowDown":e.preventDefault(),r();break;case"Escape":c()}}),o.addEventListener("keydown",e=>{const t=document.activeElement,o=Array.from(n).indexOf(t);switch(e.key){case"ArrowDown":e.preventDefault(),o<n.length-1&&n[o+1].focus();break;case"ArrowUp":e.preventDefault(),o>0&&n[o-1].focus();break;case"Enter":case" ":e.preventDefault(),t&&t.classList.contains("mixcloud-dropdown-option")&&s(t);break;case"Escape":e.preventDefault(),c()}}),n.forEach(e=>{e.setAttribute("tabindex","-1")}))})}function o(){const e=document.querySelectorAll(".mixcloud-stats");if("IntersectionObserver"in window){const t=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&e.target.classList.add("mixcloud-stats-visible")})},{threshold:.5});e.forEach(function(e){t.observe(e)})}}function n(){const e=document.querySelectorAll(".mixcloud-artwork[data-src]");if(0!==e.length)if("IntersectionObserver"in window){const t=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){const o=e.target;i(o),t.unobserve(o)}})},{rootMargin:"25px",threshold:.1});e.forEach(function(e){t.observe(e)})}else e.forEach(function(e){i(e)})}function i(e){const t=e.getAttribute("data-src");if(!t)return;e.classList.add("mixcloud-artwork-loading");const o=new Image;o.onload=function(){e.src=t,e.classList.remove("mixcloud-artwork-loading"),e.classList.add("mixcloud-artwork-loaded"),e.removeAttribute("data-src")},o.onerror=function(){e.classList.remove("mixcloud-artwork-loading"),c(e)},o.src=t}function r(){document.querySelectorAll(".mixcloud-artwork").forEach(function(e){e.addEventListener("error",function(){c(e)},{once:!0})})}function c(e){const t=e.parentElement;e.style.display="none";const o=document.createElement("div");o.className="mixcloud-artwork-error",o.innerHTML='<span class="dashicons dashicons-format-audio"></span>',o.setAttribute("aria-label",wpMixcloudArchives.noArtworkText),t.appendChild(o)}const a=new Map;function s(e,t,o={}){const{timeout:n=1e4,retries:i=2,signal:r}=o;return"undefined"!=typeof fetch&&"undefined"!=typeof AbortController?async function(e,t,o={}){const{timeout:n=1e4,retries:i=2,signal:r}=o;let c;for(let o=0;o<=i;o++)try{const o=new AbortController,i=setTimeout(()=>o.abort(),n),c=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t),signal:r||o.signal});if(clearTimeout(i),!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);return await c.json()}catch(e){if(c=e,"AbortError"===e.name)throw e;if(o===i)throw e;const t=Math.min(1e3*Math.pow(2,o),5e3);await new Promise(e=>setTimeout(e,t))}throw c}(e,t,o):function(e,t,o={}){const{timeout:n=1e4,retries:i=2}=o;return new Promise((o,r)=>{let c=0;function a(){const s=new XMLHttpRequest;function l(e){if(c<i){c++;const e=Math.min(1e3*Math.pow(2,c-1),5e3);setTimeout(a,e)}else r(e)}s.open("POST",e,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.timeout=n,s.onload=function(){if(s.status>=200&&s.status<300)try{const e=JSON.parse(s.responseText);o(e)}catch(e){r(new Error("Invalid JSON response"))}else{l(new Error(`HTTP ${s.status}: ${s.statusText}`))}},s.onerror=function(){l(new Error("Network error"))},s.ontimeout=function(){l(new Error("Request timeout"))};const d=Object.keys(t).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e])).join("&");s.send(d)}a()})}(e,t,o)}function l(i,c,l){const u=document.querySelector('.mixcloud-archives-container[data-account="'+i+'"]'),m=u?u.querySelector(".mixcloud-archives-table tbody"):null,f=u?u.querySelector(".mixcloud-date-apply"):null;if(!u||!m||!f)return;const p=`filter_${i}_${c}_${l}`;if(a.has(p))return;f.disabled=!0,f.innerHTML='<span class="mixcloud-loading-spinner"></span>'+(wpMixcloudArchives.filteringText||"Filtering..."),m.classList.add("mixcloud-table-loading");const h={action:"mixcloud_filter_by_date",nonce:wpMixcloudArchives.nonce,account:i,start_date:c,end_date:l,limit:20,lazy_load:"true",mini_player:"true"},w=new AbortController;a.set(p,w),s(wpMixcloudArchives.ajaxUrl,h,{signal:w.signal,timeout:1e4,retries:2}).then(i=>{i.success?(m.innerHTML=i.data.html,e(),n(),r(),o(),t(),d(u,i.data.message,"success")):d(u,i.data.message||"An error occurred while filtering.","error")}).catch(e=>{if("AbortError"!==e.name){const t=e.message||wpMixcloudArchives.filterErrorText||"Failed to filter results. Please try again.";d(u,t,"error")}}).finally(()=>{a.delete(p),f.disabled=!1,f.innerHTML=wpMixcloudArchives.applyFilterText||"Apply Filter",m.classList.remove("mixcloud-table-loading")})}function d(e,t,o){e.querySelectorAll(".mixcloud-filter-message").forEach(e=>e.remove());const n=document.createElement("div");n.className="mixcloud-filter-message mixcloud-filter-message-"+o,n.innerHTML=t;const i=e.querySelector(".mixcloud-date-filter");i?i.parentNode.insertBefore(n,i.nextSibling):e.insertBefore(n,e.firstChild),setTimeout(()=>{n.parentNode&&n.remove()},5e3)}function u(){document.querySelectorAll(".mixcloud-social-btn").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("data-platform"),o=this.closest(".mixcloud-social-sharing");if(!o)return;!function(e,t,o,n,i){let r="";switch(e){case"facebook":r="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t);break;case"twitter":r="https://twitter.com/intent/tweet?text="+encodeURIComponent(o+" - "+n)+"&url="+encodeURIComponent(t);break;case"bluesky":r="https://bsky.app/intent/compose?text="+encodeURIComponent(o+" - "+n+" "+t);break;case"copy":return void function(e,t){navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(function(){f(t)}).catch(function(o){m(e,t)}):m(e,t)}(t,i)}if(r){"undefined"!=typeof gtag&&gtag("event","share",{method:e,content_type:"mixcloud_track",content_id:t});const o=window.open(r,"social-share","width=600,height=400,scrollbars=yes,resizable=yes");o&&o.focus()}}(t,o.getAttribute("data-url"),o.getAttribute("data-title"),o.getAttribute("data-description"),this)})})}function m(e,t){const o=document.createElement("textarea");o.value=e,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.focus(),o.select();try{document.execCommand("copy")?f(t):p(t)}catch(e){p(t)}document.body.removeChild(o)}function f(e){const t=e.innerHTML,o=e.className;e.classList.add("copied"),e.innerHTML='<span class="dashicons dashicons-yes"></span><span class="mixcloud-social-label">Copied!</span>',"undefined"!=typeof gtag&&gtag("event","copy_link",{event_category:"social_sharing",event_label:"mixcloud_track"}),setTimeout(function(){e.className=o,e.innerHTML=t},2e3)}function p(e){const t=e.innerHTML;e.innerHTML='<span class="dashicons dashicons-no"></span><span class="mixcloud-social-label">Failed</span>',setTimeout(function(){e.innerHTML=t},2e3)}function h(){e(),t(),n(),o(),r(),document.querySelectorAll(".mixcloud-date-filter").forEach(function(e){const t=e.querySelector(".mixcloud-date-apply"),o=e.querySelector(".mixcloud-date-clear"),n=e.querySelector(".mixcloud-start-date"),i=e.querySelector(".mixcloud-end-date");if(!(t&&o&&n&&i))return;let r;function c(){clearTimeout(r),r=setTimeout(function(){const e=n.getAttribute("data-account"),t=n.value,o=i.value;t&&o&&new Date(t)<=new Date(o)&&l(e,t,o)},500)}t.addEventListener("click",function(){const e=this.getAttribute("data-account"),t=n.value,o=i.value;t&&o&&new Date(t)>new Date(o)?alert(wpMixcloudArchives.invalidDateRangeText||"End date must be after start date."):l(e,t,o)}),o.addEventListener("click",function(){const e=this.getAttribute("data-account");n.value="",i.value="",l(e,"","")}),n.addEventListener("change",c),i.addEventListener("change",c)}),u()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h(),document.addEventListener("wp-mixcloud-archives-refresh",h)}(),window.wpMixcloudArchivesRefresh=function(){document.dispatchEvent(new Event("wp-mixcloud-archives-refresh"))};