!function(){"use strict";function e(){const e=document.querySelectorAll(".mixcloud-card-artwork"),o=document.getElementById("mixcloud-player-modal"),n=document.querySelector(".mixcloud-modal-player-container"),c=document.querySelector(".mixcloud-modal-close");o&&n&&c&&(e.forEach(function(e){e.addEventListener("click",function(){e.getAttribute("data-cloudcast-key");const t=e.getAttribute("data-cloudcast-url"),c=e.getAttribute("data-cloudcast-name");t&&function(e,t,o,n){const c={hide_cover:"1",mini:"0",light:"1",hide_artwork:"0",autoplay:"0"},i=o.replace("https://www.mixcloud.com/","https://www.mixcloud.com/widget/iframe/?feed="),a=Object.keys(c).map(e=>e+"="+c[e]).join("&"),r=i+"&"+a,l=document.createElement("iframe");l.src=r,l.width="100%",l.height="380",l.frameBorder="0",l.allowFullscreen=!0,l.title="Mixcloud player for "+n,t.innerHTML="",t.appendChild(l),e.style.display="block",document.body.style.overflow="hidden"}(o,n,t,c)})}),c.addEventListener("click",function(){t(o,n)}),o.addEventListener("click",function(e){e.target===o&&t(o,n)}),document.addEventListener("keydown",function(e){"Escape"===e.key&&"block"===o.style.display&&t(o,n)}))}function t(e,t){e.style.display="none",document.body.style.overflow="",t.innerHTML=""}function o(){const e=document.querySelectorAll(".mixcloud-stats");if("IntersectionObserver"in window){const t=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&e.target.classList.add("mixcloud-stats-visible")})},{threshold:.5});e.forEach(function(e){t.observe(e)})}}function n(){const e=document.querySelectorAll(".mixcloud-artwork[data-src]");if(0!==e.length)if("IntersectionObserver"in window){const t=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){const o=e.target;c(o),t.unobserve(o)}})},{rootMargin:"25px",threshold:.1});e.forEach(function(e){t.observe(e)})}else e.forEach(function(e){c(e)})}function c(e){const t=e.getAttribute("data-src");if(!t)return;e.classList.add("mixcloud-artwork-loading");const o=new Image;o.onload=function(){e.src=t,e.classList.remove("mixcloud-artwork-loading"),e.classList.add("mixcloud-artwork-loaded"),e.removeAttribute("data-src")},o.onerror=function(){e.classList.remove("mixcloud-artwork-loading"),a(e)},o.src=t}function i(){document.querySelectorAll(".mixcloud-artwork").forEach(function(e){e.addEventListener("error",function(){a(e)},{once:!0})})}function a(e){const t=e.parentElement;e.style.display="none";const o=document.createElement("div");o.className="mixcloud-artwork-error",o.innerHTML='<span class="dashicons dashicons-format-audio"></span>',o.setAttribute("aria-label",wpMixcloudArchives.noArtworkText),t.appendChild(o)}const r=new Map;async function l(e,t,o={}){const{timeout:n=1e4,retries:c=2,signal:i}=o;let a;for(let o=0;o<=c;o++)try{const o=new Promise((e,t)=>{setTimeout(()=>t(new Error("Request timeout")),n)}),c=fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t),signal:i}),a=await Promise.race([c,o]);if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);return await a.json()}catch(e){if(a=e,"AbortError"===e.name)throw e;if(o===c)throw e;const t=Math.min(1e3*Math.pow(2,o),5e3);await new Promise(e=>setTimeout(e,t))}throw a}function s(t,c,a){const s=document.querySelector('.mixcloud-archives-container[data-account="'+t+'"]'),u=s?s.querySelector(".mixcloud-archives-table tbody"):null,m=s?s.querySelector(".mixcloud-date-apply"):null;if(!s||!u||!m)return;const f=`filter_${t}_${c}_${a}`;if(r.has(f))return;m.disabled=!0,m.innerHTML='<span class="mixcloud-loading-spinner"></span>'+(wpMixcloudArchives.filteringText||"Filtering..."),u.classList.add("mixcloud-table-loading");const p={action:"mixcloud_filter_by_date",nonce:wpMixcloudArchives.nonce,account:t,start_date:c,end_date:a,limit:20,lazy_load:"true",mini_player:"true"},h=new AbortController;r.set(f,h),l(wpMixcloudArchives.ajaxUrl,p,{signal:h.signal,timeout:1e4,retries:2}).then(t=>{t.success?(u.innerHTML=t.data.html,e(),n(),i(),o(),d(s,t.data.message,"success")):d(s,t.data.message||"An error occurred while filtering.","error")}).catch(e=>{if("AbortError"!==e.name){console.error("Date filter error:",e);const t=e.message||wpMixcloudArchives.filterErrorText||"Failed to filter results. Please try again.";d(s,t,"error")}}).finally(()=>{r.delete(f),m.disabled=!1,m.innerHTML=wpMixcloudArchives.applyFilterText||"Apply Filter",u.classList.remove("mixcloud-table-loading")})}function d(e,t,o){e.querySelectorAll(".mixcloud-filter-message").forEach(e=>e.remove());const n=document.createElement("div");n.className="mixcloud-filter-message mixcloud-filter-message-"+o,n.innerHTML=t;const c=e.querySelector(".mixcloud-date-filter");c?c.parentNode.insertBefore(n,c.nextSibling):e.insertBefore(n,e.firstChild),setTimeout(()=>{n.parentNode&&n.remove()},5e3)}function u(){document.querySelectorAll(".mixcloud-pagination").forEach(function(t){const c=t.getAttribute("data-account");t.querySelectorAll(".mixcloud-pagination-btn, .mixcloud-pagination-link").forEach(function(t){t.addEventListener("click",function(t){t.preventDefault();const a=this.getAttribute("data-page");a&&!this.classList.contains("mixcloud-pagination-disabled")&&function(t,c){const a=document.querySelector('.mixcloud-archives-container[data-account="'+t+'"]'),s=a?a.querySelector(".mixcloud-archives-table tbody"):null,m=a?a.querySelector(".mixcloud-pagination"):null;if(!a||!s||!m)return;const f=`paginate_${t}_${c}`;if(r.has(f))return;const p=a.querySelector(".mixcloud-start-date"),h=a.querySelector(".mixcloud-end-date"),y=p?p.value:"",g=h?h.value:"";m.classList.add("mixcloud-pagination-loading"),s.classList.add("mixcloud-table-loading");m.querySelector(".mixcloud-pagination-info");let x=10;const w={action:"mixcloud_paginate",nonce:wpMixcloudArchives.nonce,account:t,page:c,per_page:x,start_date:y,end_date:g,limit:100,lazy_load:"true",mini_player:"true"},b=new AbortController;r.set(f,b),l(wpMixcloudArchives.ajaxUrl,w,{signal:b.signal,timeout:15e3,retries:2}).then(t=>{t.success?(s.innerHTML=t.data.table_html,m.outerHTML=t.data.pagination_html,e(),n(),i(),o(),u(),a.scrollIntoView({behavior:"smooth",block:"start"}),d(a,t.data.message,"success")):d(a,t.data.message||"An error occurred while loading the page.","error")}).catch(e=>{if("AbortError"!==e.name){console.error("Pagination error:",e);const t=e.message||wpMixcloudArchives.paginationErrorText||"Failed to load page. Please try again.";d(a,t,"error")}}).finally(()=>{r.delete(f);const e=document.querySelector('.mixcloud-pagination[data-account="'+t+'"]');e&&e.classList.remove("mixcloud-pagination-loading"),s.classList.remove("mixcloud-table-loading")})}(c,parseInt(a))})});t.querySelectorAll(".mixcloud-pagination-number").forEach(function(e){e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())})})})}function m(){document.querySelectorAll(".mixcloud-social-btn").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("data-platform"),o=this.closest(".mixcloud-social-sharing");if(!o)return;!function(e,t,o,n,c){let i="";switch(e){case"facebook":i="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t);break;case"twitter":i="https://twitter.com/intent/tweet?text="+encodeURIComponent(o+" - "+n)+"&url="+encodeURIComponent(t);break;case"bluesky":i="https://bsky.app/intent/compose?text="+encodeURIComponent(o+" - "+n+" "+t);break;case"copy":return void function(e,t){navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(function(){p(t)}).catch(function(o){console.warn("Failed to copy to clipboard:",o),f(e,t)}):f(e,t)}(t,c)}if(i){"undefined"!=typeof gtag&&gtag("event","share",{method:e,content_type:"mixcloud_track",content_id:t});const o=window.open(i,"social-share","width=600,height=400,scrollbars=yes,resizable=yes");o&&o.focus()}}(t,o.getAttribute("data-url"),o.getAttribute("data-title"),o.getAttribute("data-description"),this)})})}function f(e,t){const o=document.createElement("textarea");o.value=e,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.focus(),o.select();try{document.execCommand("copy")?p(t):h(t)}catch(e){console.warn("Fallback copy failed:",e),h(t)}document.body.removeChild(o)}function p(e){const t=e.innerHTML,o=e.className;e.classList.add("copied"),e.innerHTML='<span class="dashicons dashicons-yes"></span><span class="mixcloud-social-label">Copied!</span>',"undefined"!=typeof gtag&&gtag("event","copy_link",{event_category:"social_sharing",event_label:"mixcloud_track"}),setTimeout(function(){e.className=o,e.innerHTML=t},2e3)}function h(e){const t=e.innerHTML;e.innerHTML='<span class="dashicons dashicons-no"></span><span class="mixcloud-social-label">Failed</span>',setTimeout(function(){e.innerHTML=t},2e3)}function y(){e(),n(),document.querySelectorAll(".mixcloud-archives-table").forEach(function(e){const t=e.querySelectorAll("thead th");e.querySelectorAll("tbody tr").forEach(function(e){e.querySelectorAll("td").forEach(function(e,o){t[o]&&e.setAttribute("data-label",t[o].textContent)})})}),o(),i(),document.querySelectorAll(".mixcloud-date-filter").forEach(function(e){const t=e.querySelector(".mixcloud-date-apply"),o=e.querySelector(".mixcloud-date-clear"),n=e.querySelector(".mixcloud-start-date"),c=e.querySelector(".mixcloud-end-date");if(!(t&&o&&n&&c))return;let i;function a(){clearTimeout(i),i=setTimeout(function(){const e=n.getAttribute("data-account"),t=n.value,o=c.value;t&&o&&new Date(t)<=new Date(o)&&s(e,t,o)},500)}t.addEventListener("click",function(){const e=this.getAttribute("data-account"),t=n.value,o=c.value;t&&o&&new Date(t)>new Date(o)?alert(wpMixcloudArchives.invalidDateRangeText||"End date must be after start date."):s(e,t,o)}),o.addEventListener("click",function(){const e=this.getAttribute("data-account");n.value="",c.value="",s(e,"","")}),n.addEventListener("change",a),c.addEventListener("change",a)}),u(),m()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y(),document.addEventListener("wp-mixcloud-archives-refresh",y)}(),window.wpMixcloudArchivesRefresh=function(){document.dispatchEvent(new Event("wp-mixcloud-archives-refresh"))};